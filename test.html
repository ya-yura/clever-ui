<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç —Å–∏—Å—Ç–µ–º—ã –ø—Ä–∏—ë–º–∫–∏ —Ç–æ–≤–∞—Ä–∞</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 10px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .status {
            padding: 5px 10px;
            border-radius: 4px;
            font-weight: bold;
        }
        .status.pass { background: #d4edda; color: #155724; }
        .status.fail { background: #f8d7da; color: #721c24; }
        .status.pending { background: #fff3cd; color: #856404; }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #0056b3; }
        input {
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            margin: 5px;
        }
    </style>
</head>
<body>
    <h1>üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã –ø—Ä–∏—ë–º–∫–∏ —Ç–æ–≤–∞—Ä–∞</h1>

    <div class="test-section">
        <h2>1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–µ–º–æ-–¥–∞–Ω–Ω—ã—Ö</h2>
        <div id="demo-test" class="status pending">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
        <button onclick="testDemoData()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–µ–º–æ-–¥–∞–Ω–Ω—ã–µ</button>
    </div>

    <div class="test-section">
        <h2>2. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è</h2>
        <div id="scan-test" class="status pending">–û–∂–∏–¥–∞–Ω–∏–µ</div>
        <input type="text" id="barcode-input" placeholder="–í–≤–µ–¥–∏—Ç–µ —à—Ç—Ä–∏—Ö–∫–æ–¥">
        <button onclick="testScan()">–°–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å</button>
        <div id="scan-result"></div>
    </div>

    <div class="test-section">
        <h2>3. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º</h2>
        <div id="quantity-test" class="status pending">–û–∂–∏–¥–∞–Ω–∏–µ</div>
        <div id="quantity-control">
            <button onclick="adjustQuantity(-1)">-1</button>
            <span id="quantity">5</span>
            <button onclick="adjustQuantity(1)">+1</button>
        </div>
    </div>

    <div class="test-section">
        <h2>4. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞</h2>
        <div id="document-test" class="status pending">–û–∂–∏–¥–∞–Ω–∏–µ</div>
        <button onclick="testDocument()">–ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç</button>
        <div id="document-result"></div>
    </div>

    <div class="test-section">
        <h2>5. –ò—Ç–æ–≥–æ–≤—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç</h2>
        <div id="final-result" class="status pending">–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ</div>
        <button onclick="runAllTests()">–ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Ç–µ—Å—Ç—ã</button>
    </div>

    <script>
        let testResults = {
            demo: false,
            scan: false,
            quantity: false,
            document: false
        };

        // –¢–µ—Å—Ç –¥–µ–º–æ-–¥–∞–Ω–Ω—ã—Ö
        async function testDemoData() {
            try {
                // –ò–º–∏—Ç–∞—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–µ–º–æ-–¥–∞–Ω–Ω—ã—Ö
                const demoData = {
                    documents: { PrihodNaSklad: [{ id: 'prihod-001', name: '–¢–µ—Å—Ç–æ–≤—ã–π –¥–æ–∫—É–º–µ–Ω—Ç' }] },
                    products: [
                        { id: '1', name: '–¢–µ—Å—Ç–æ–≤—ã–π —Ç–æ–≤–∞—Ä', barcode: '123456789' }
                    ]
                };

                document.getElementById('demo-test').className = 'status pass';
                document.getElementById('demo-test').textContent = '‚úÖ –î–µ–º–æ-–¥–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã';
                testResults.demo = true;
                return true;
            } catch (error) {
                document.getElementById('demo-test').className = 'status fail';
                document.getElementById('demo-test').textContent = '‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–µ–º–æ-–¥–∞–Ω–Ω—ã—Ö';
                return false;
            }
        }

        // –¢–µ—Å—Ç —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
        function testScan() {
            const barcode = document.getElementById('barcode-input').value;
            const resultDiv = document.getElementById('scan-result');

            if (!barcode) {
                resultDiv.innerHTML = '<span style="color: red;">–í–≤–µ–¥–∏—Ç–µ —à—Ç—Ä–∏—Ö–∫–æ–¥</span>';
                return;
            }

            // –ò–º–∏—Ç–∞—Ü–∏—è –ø–æ–∏—Å–∫–∞ —Ç–æ–≤–∞—Ä–∞
            const products = [
                { barcode: '123456789', name: '–¢–µ—Å—Ç–æ–≤—ã–π —Ç–æ–≤–∞—Ä 1' },
                { barcode: '987654321', name: '–¢–µ—Å—Ç–æ–≤—ã–π —Ç–æ–≤–∞—Ä 2' }
            ];

            const product = products.find(p => p.barcode === barcode);

            if (product) {
                resultDiv.innerHTML = `<span style="color: green;">‚úÖ –ù–∞–π–¥–µ–Ω: ${product.name}</span>`;
                document.getElementById('scan-test').className = 'status pass';
                document.getElementById('scan-test').textContent = '‚úÖ –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç';
                testResults.scan = true;
            } else {
                resultDiv.innerHTML = '<span style="color: red;">‚ùå –¢–æ–≤–∞—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω</span>';
                document.getElementById('scan-test').className = 'status fail';
                document.getElementById('scan-test').textContent = '‚ùå –¢–æ–≤–∞—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω';
            }
        }

        // –¢–µ—Å—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º
        function adjustQuantity(delta) {
            const quantitySpan = document.getElementById('quantity');
            let current = parseInt(quantitySpan.textContent);
            current = Math.max(0, current + delta);
            quantitySpan.textContent = current;

            document.getElementById('quantity-test').className = 'status pass';
            document.getElementById('quantity-test').textContent = '‚úÖ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º —Ä–∞–±–æ—Ç–∞–µ—Ç';
            testResults.quantity = true;
        }

        // –¢–µ—Å—Ç –¥–æ–∫—É–º–µ–Ω—Ç–∞
        function testDocument() {
            const resultDiv = document.getElementById('document-result');

            // –ò–º–∏—Ç–∞—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞
            const mockDocument = {
                id: 'prihod-001',
                name: '–¢–µ—Å—Ç–æ–≤—ã–π –¥–æ–∫—É–º–µ–Ω—Ç –ø—Ä–∏—ë–º–∫–∏',
                status: 'in_progress',
                lines: [
                    { productName: '–¢–æ–≤–∞—Ä 1', quantityPlan: 10, quantityFact: 5 },
                    { productName: '–¢–æ–≤–∞—Ä 2', quantityPlan: 5, quantityFact: 5 }
                ]
            };

            resultDiv.innerHTML = `
                <h3>${mockDocument.name}</h3>
                <p>–°—Ç–∞—Ç—É—Å: ${mockDocument.status}</p>
                <p>–°—Ç—Ä–æ–∫: ${mockDocument.lines.length}</p>
                <ul>
                    ${mockDocument.lines.map(line =>
                        `<li>${line.productName}: ${line.quantityFact}/${line.quantityPlan}</li>`
                    ).join('')}
                </ul>
            `;

            document.getElementById('document-test').className = 'status pass';
            document.getElementById('document-test').textContent = '‚úÖ –î–æ–∫—É–º–µ–Ω—Ç –∑–∞–≥—Ä—É–∂–µ–Ω';
            testResults.document = true;
        }

        // –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤
        async function runAllTests() {
            await testDemoData();
            testDocument();

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
            const passedTests = Object.values(testResults).filter(Boolean).length;
            const totalTests = Object.keys(testResults).length;

            const resultDiv = document.getElementById('final-result');
            if (passedTests === totalTests) {
                resultDiv.className = 'status pass';
                resultDiv.textContent = `‚úÖ –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã (${passedTests}/${totalTests})`;
            } else {
                resultDiv.className = 'status fail';
                resultDiv.textContent = `‚ùå –ù–µ–∫–æ—Ç–æ—Ä—ã–µ —Ç–µ—Å—Ç—ã –Ω–µ –ø—Ä–æ–π–¥–µ–Ω—ã (${passedTests}/${totalTests})`;
            }
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ –±–∞–∑–æ–≤—ã—Ö —Ç–µ—Å—Ç–æ–≤
        window.onload = async function() {
            await testDemoData();
            testDocument();
        };
    </script>
</body>
</html>